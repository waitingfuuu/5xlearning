<h1 style="width:100%;text-align:center"><%= t('index.title') %></h1>

<%= link_to "中文版", :locale => "zh-TW" %>
<%= link_to "English", :locale => "en" %>

<%= form_tag(root_path, :method => "get") do %>
    <%= search_field_tag :search %>
    <%= submit_tag t('index.searchBtn') %>
<% end %>
<br>

<%= link_to t('form.create_task'), new_task_path %>
<br>

<table style="width:100%;text-align:center" id='task_list_table'>
  <thead>
    <tr>
      <th><%= t('task.title') %></th>
      <th><%= t('task.content') %></th>
      <th><%= t('task.tag') %></th>
      <th><%= t('task.start') %></th>
      <th>
        <% if params[:end_time] == 'asc' %>
          <%= link_to t('task.deadline'), root_path(:end_time => 'desc') %>
        <% else %>
          <%= link_to t('task.deadline'), root_path(:end_time => 'asc') %>
        <% end %>
      </th>
      <th><%= t('task.created_at') %></th>
      <th>
        <% if params[:priority] == 'asc' %>
          <%= link_to t('task.priority'), root_path(:priority => 'desc') %>
        <% else %>
          <%= link_to t('task.priority'), root_path(:priority => 'asc') %>
        <% end %>
      </th>
      <th><%= t('task.state') %></th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @tasks.each_with_index do |task, index| %>
      <tr id = <%= index %> >
        <td class='title'><%= task.title %></td>
        <td><%= task.content %></td>
        <td><%= task.tag %></td>
        <td><%= task.start_time.strftime('%Y/%m/%d %H:%M') %></td>
        <td class='end_time'><%= task.end_time.strftime('%Y/%m/%d %H:%M') %></td>
        <td class='created_at'><%= task.created_at.strftime('%Y/%m/%d %H:%M') %></td>
        <% Rails.logger.info('****************************') %>
        <% Rails.logger.info(task.priority) %>
        <% Rails.logger.info(task.state) %>
        <% Rails.logger.info('****************************') %>
        <td class='priority'><%= t("task.#{task.priority}") %></td>
        <td class='state'><%= t("task.#{task.state}") %></td>
        <td><%= link_to t('index.edit'), edit_task_path(task) %></td>
        <td><%= link_to t('index.delete'), task, data: { turbo_method: :delete, turbo_confirm: "Are you sure?" } %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br />
<% if flash[:notice] %>
  <div class="notice" style="color:red"><%= flash[:notice] %></div>
<% end %>